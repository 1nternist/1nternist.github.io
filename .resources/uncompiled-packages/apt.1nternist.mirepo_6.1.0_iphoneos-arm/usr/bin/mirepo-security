#!/bin/bash
# Basic host check :)

if [ ! -e /etc/hosts ]; then
	echo "Hosts file does not exist"
	echo 'RESTORING THE DEFAULT /etc/hosts'
echo '##' > /etc/hosts
echo '# Host Database
#
# localhost is used to configure the loopback interface
# when the system is booting.  Do not change this entry.
##
127.0.0.1	 localhost
255.255.255.255  broadcasthost
::1		 localhost
fe80::1%lo0	 localhost

########################
## Personal Redirects ##
########################

127.0.0.1 cydia.mirepo.com

' >> /etc/hosts
	ls -l /etc/hosts
	if [[ -n $(ps aux | grep 'discoveryd' | grep ^_mdnsresponder) ]]; then
		echo 'RESTARTING discoveryd'
		# FIX CPU 100% AFTER THE INSTALL
		killall discoveryd && echo 'discoveryd RESTARTED'
	fi
else
	echo "`cat /etc/hosts | grep cydia.mirepo.com | sed 's/#127.0.0.1 cydia.mirepo.com/127.0.0.1 cydia.mirepo.com/g'`" </etc/hosts
fi

exit 0
